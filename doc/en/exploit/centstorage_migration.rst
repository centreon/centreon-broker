##############################
Centstorage to Centreon Broker
##############################

One key feature of Centreon is to generate graphs with information
provided from the monitoring. Historically, this was done through
the *Centstorage* software. Now Centreon Broker can handle graph
generation in a harder, better, faster, stronger way. Centreon Broker
provide more options and consume less resources than Centstorage.

Prerequisites
=============

It is assumed that you're already using Centreon Broker in your Centreon
setup. We suppose we have a MySQL database on *10.30.2.62* with the user
*centreon* and the password *centreon*.

The Storage engine
==================

Rationale
---------

The Storage engine communicates with the *storage database*, which
contains the *index_data*, *metrics* and *data_bin* tables. This
database holds useful information that are filled by the Storage engine
and used by Centreon to properly print graphs. Without a Storage engine
in your setup, no Centreon-compatible graphs could be generated by
Centreon Broker.

Adding the Storage engine in Centreon
-------------------------------------

Connect to the Centreon interface and go to *Configuration*, then
*Centreon* and finally *Centreon-Broker* to select your central
configuration file.

.. image:: /_static/images/exploitation/conf_modif_central_broker.png
   :align: center

In the *Output* tab, add a *Storage - Perfdata Generator* output with
information similar to the following.

.. image:: /_static/images/exploitation/conf_add_broker_storage.png
   :align: center

====================== =======================================
Information            Value
====================== =======================================
Name                   central-broker-perfdata-master
Failover               central-broker-perfdata-master-failover
DB host                localhost
DB port                3306
DB user                centreon
DB password            centreon
DB name                centreon_storage
====================== =======================================

Also, don't forget to add a *File - File* failover for the previous
output.

.. image:: /_static/images/exploitation/conf_add_broker_storage_failover.png
   :align: center

====================== ===================================================================
Information            Value
====================== ===================================================================
Name                   central-broker-perfdata-master-failover
File path              /var/lib/centreon/retention/central-broker-perfdata-master.failover
====================== ===================================================================

The RRD engine
==============

Rationale
---------

The RRD engine write RRD files on disk from information provided by the
Storage engine. It also handles their deletion or rebuild. The RRD
has multiple options, the most important being the ability to write RRD
files through the *rrdcached* software.

Adding the RRD engine in Centreon
---------------------------------

In a similar manner than what was done for the Storage engine, add a
new output *RRD - RRD File Generator* with the following caracteristics.

.. image:: /_static/images/exploitation/conf_add_broker_rrd.png
   :align: center

====================== ==================================
Information            Value
====================== ==================================
Name                   central-broker-rrd-master
Failover               central-broker-rrd-master-failover
====================== ==================================

Once again, don't forget to add a *File - File* failover for the previous
output.

.. image:: /_static/images/exploitation/conf_add_broker_rrd_failover.png
   :align: center

====================== ==============================================================
Information            Value
====================== ==============================================================
Name                   central-broker-rrd-master-failover
File path              /var/lib/centreon/retention/central-broker-rrd-master.failover
====================== ==============================================================

Disable Centstorage
===================

Go to *Administration*, then *Options*, *CentStorage* and uncheck
*Enable Centstorage Engine*.

From the command prompt you can now stop CentStorage.

::

  /etc/init.d/centstorage stop

Final steps
===========

Finally, go to *Configuration* then *Monitoring Engine*. Export the
configuration and restart engines. Graphs are now written by Centreon
Broker !
